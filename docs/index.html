<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EchoBreak</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="images/favicon.png">
</head>

<body>

    <!-- Header -->
    <header>
        <a href="personal_account.html" id="logo-link" class="active">
            <img src="images/logo.png" alt="EchoBreak Logo" class="logo">
        </a>
        <nav>
            <ul>
                <space></space>
                <li><a href="about.html">О нас</a></li>
                <li><a href="projects.html">Проекты</a></li>
                <li><a href="fanfics.html">Комьюнити</a></li>
                <li><a href="crypto.html">Крипта</a></li>
            </ul>
        </nav>
    </header>

    <!-- Separator Line -->
    <div class="separator"></div>

    <!-- Main Content -->
    <main>
        <!-- New Year Countdown -->
        <div id="ny-countdown" class="countdown-above-title"></div>

        <h1>EchoBreak</h1>
        <h2>Главная</h2>
        <h3>Этот сайт был сделан исключительно в образовательных целях!</h3>

        <!-- Terminal-style Interactive Prompt -->
        <div id="terminal" class="terminal">
            <div id="terminal-output" class="terminal-output"></div>
            <div class="terminal-input-line">
                <span class="prompt">> </span>
                <input type="text" id="terminal-input" autocomplete="off" spellcheck="false">
            </div>
        </div>

        <!-- Countdown to May 31 -->
        <div id="may-countdown" class="countdown-below-terminal"></div>

        <!-- Countdown to next holiday -->
        <div id="holiday-countdown" class="countdown-below-terminal"></div>
    </main>

    <!-- Footer -->
    <footer>
        <p>EchoBreak, 2025</p>
    </footer>

    <!-- Falling Snow Container -->
    <div id="snow-container"></div>

    <script>
        const snowContainer = document.getElementById('snow-container');
        const flakes = ['*', '·', '✦', '✧', '+', '∘', '•'];
        const snowCount = 35;

        snowContainer.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        `;

        for (let i = 0; i < snowCount; i++) {
            const flake = document.createElement('span');

            // Rare custom snowflake: chance
            let isCustom = Math.random() < 0.01;

            if (isCustom) {
                flake.textContent = '卐'; // Custom snowflake symbol
                flake.style.color = '#9ab5ff'; // Red for testing
            } else {
                flake.textContent = flakes[Math.floor(Math.random() * flakes.length)];
                flake.style.color = '#9ab5ff'; // Original color
            }

            const size = 8 + Math.random() * 10;
            const left = Math.random() * 100;
            const duration = 6 + Math.random() * 10;
            const opacity = 0.4 + Math.random() * 0.6;
            const delay = Math.random() * 5;

            flake.style.cssText += `
                position: absolute;
                top: -20px;
                left: ${left}vw;
                font-size: ${size}px;
                opacity: ${opacity};
                font-family: monospace;
                user-select: none;
                animation: snowfall ${duration}s linear infinite;
                animation-delay: ${delay}s;
            `;
            snowContainer.appendChild(flake);
        }

        // === COUNTDOWN TO JAN 1, 2026 00:00 UTC+3 ===
        const countdownEl = document.getElementById('ny-countdown');

        function updateCountdown() {
            const ny2026UTC = Date.UTC(2025, 11, 31, 21, 0, 0);
            const diff = ny2026UTC - Date.now();

            if (diff <= 0) {
                countdownEl.textContent = 'С Новым Годом 2026!';
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const secs = Math.floor((diff % (1000 * 60)) / 1000);

            countdownEl.textContent = `Новый Год через: ${days}д ${hours}ч ${mins}м ${secs}с`;
        }

        if (!document.getElementById('ny-snow-style')) {
            const style = document.createElement('style');
            style.id = 'ny-snow-style';
            style.textContent = `
                @keyframes snowfall {
                    0% { transform: translateY(-10vh) rotate(0deg); }
                    100% { transform: translateY(110vh) rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
        }

        setInterval(updateCountdown, 1000);
        updateCountdown();

        const terminalInput = document.getElementById('terminal-input');
        const terminalOutput = document.getElementById('terminal-output');

        function printLine(text) {
            const line = document.createElement('div');
            line.textContent = text;
            terminalOutput.appendChild(line);
        }

        function printCommand(command) {
            const line = document.createElement('div');
            line.innerHTML = '<span class="prompt">&gt;</span> ' + command;
            terminalOutput.appendChild(line);
        }

        terminalInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const input = terminalInput.value.trim();
                if (!input) return;

                terminalInput.value = '';
                printCommand(input);

                const [cmd, ...args] = input.split(' ');
                const argStr = args.join(' ').trim();

                if (cmd === 'cd') {
                    if (!argStr) {
                        printLine('Использование: cd <страница>');
                        printLine('Доступно: about, projects, fanfics, crypto, account');
                        return;
                    }

                    const aliases = {
                        'about': 'about.html',
                        'projects': 'projects.html',
                        'fanfics': 'fanfics.html',
                        'crypto': 'crypto.html',
                        'account': 'personal_account.html'
                    };

                    const target = aliases[argStr] || null;
                    if (target) {
                        printLine(`Переход на ${target}...`);
                        setTimeout(() => window.location.href = target, 500);
                    } else {
                        printLine(`cd: неизвестная страница "${argStr}"`);
                        printLine('Доступно: about, projects, fanfics, crypto, account');
                    }

                } else if (cmd === 'goto') {
                    if (!argStr) {
                        printLine('Использование: goto /путь/к/файлу.html');
                        return;
                    }

                    let url = argStr;
                    if (!url.startsWith('/')) {
                        url = '/' + url;
                    }

                    try {
                        const testUrl = new URL(url, window.location.origin);
                        if (testUrl.origin !== window.location.origin) {
                            throw new Error('Внешние ссылки запрещены');
                        }
                        printLine(`Переход на ${testUrl.pathname}...`);
                        setTimeout(() => window.location.href = testUrl.pathname, 500);
                    } catch (err) {
                        printLine('goto: недопустимый путь (только внутренние страницы)');
                    }

                } else if (cmd === 'time') {
                    const now = new Date().toLocaleString('ru-RU', {
                        timeZone: 'Europe/Moscow',
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    printLine(`Текущее время (МСК): ${now}`);
                } else if (cmd === 'weather') {
                    printLine('Загрузка погоды в Москве...');

                    fetch('https://wttr.in/Moscow?format=4&lang=ru  ')
                        .then(response => response.text())
                        .then(data => {
                            terminalOutput.lastChild.remove();
                            printLine('Погода в Москве:');
                            printLine(data.trim());
                        })
                        .catch(() => {
                            terminalOutput.lastChild.remove();
                            printLine('✗ Не удалось загрузить погоду.');
                        });
                } else if (cmd === 'help') {
                    printLine('Команды:');
                    printLine('  cd <страница>    — перейти на раздел (about, projects, и т.д.)');
                    printLine('  goto /путь.html  — перейти по внутреннему пути');
                    printLine('  time             — показать текущее время (МСК)');
                    printLine('  weather          — показать погоду в Москве');
                    printLine('  clear            — очистить терминал');
                } else if (cmd === 'clear') {
                    terminalOutput.innerHTML = '';

                } else {
                    printLine(`Команда "${cmd}" не найдена. Введите "help".`);
                }

                terminalOutput.scrollTop = terminalOutput.scrollHeight;
            }
        });

        terminalInput.focus();

        // === COUNTDOWN TO MAY 31, 2026 ===
        const mayCountdownEl = document.getElementById('may-countdown');

        function updateMayCountdown() {
            const may2026UTC = Date.UTC(2026, 4, 30, 21, 0, 0);
            const now = Date.now();
            const diff = may2026UTC - now;

            if (diff <= 0) {
                mayCountdownEl.textContent = 'До конца учебного года!';
            } else {
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const secs = Math.floor((diff % (1000 * 60)) / 1000);
                mayCountdownEl.textContent = `До 31 мая: ${days}д ${hours}ч ${mins}м ${secs}с`;
            }
        }

        const holidayCountdownEl = document.getElementById('holiday-countdown');

        function updateHolidayCountdown() {
            const now = new Date();
            let currentYear = now.getFullYear();

            const autumnBreakStart = Date.UTC(currentYear, 9, 24, 21); // Oct 25 MSK
            const autumnBreakEnd = Date.UTC(currentYear, 10, 1, 21); // Nov 2 MSK
            const winterBreakStart = Date.UTC(currentYear, 11, 30, 21); // Dec 31 MSK
            const winterBreakEnd = Date.UTC(currentYear + 1, 0, 10, 21); // Jan 11 MSK
            const springBreakStart = Date.UTC(currentYear + 1, 2, 27, 21); // Mar 28 MSK
            const springBreakEnd = Date.UTC(currentYear + 1, 3, 4, 21); // Apr 5 MSK

            const nowUTC = Date.now();
            let holidayText = "";
            let diff = 0;
            let isActive = false;

            if (nowUTC >= autumnBreakStart && nowUTC < autumnBreakEnd) {
                holidayText = "◈ Осенние каникулы! Закончатся через";
                diff = autumnBreakEnd - nowUTC;
                isActive = true;
            } else if (nowUTC >= winterBreakStart && nowUTC < winterBreakEnd) {
                holidayText = "❄ Зимние каникулы! Закончатся через";
                diff = winterBreakEnd - nowUTC;
                isActive = true;
            } else if (nowUTC >= springBreakStart && nowUTC < springBreakEnd) {
                holidayText = "✿ Весенние каникулы! Закончатся через";
                diff = springBreakEnd - nowUTC;
                isActive = true;
            } else {
                let nextStart = autumnBreakStart;
                if (nowUTC >= autumnBreakEnd) nextStart = winterBreakStart;
                if (nowUTC >= winterBreakEnd) nextStart = springBreakStart;
                if (nowUTC >= springBreakEnd) {
                    nextStart = Date.UTC(currentYear + 1, 9, 24, 21);
                }
                diff = nextStart - nowUTC;

                if (nextStart === autumnBreakStart || nextStart === Date.UTC(currentYear + 1, 9, 24, 21)) {
                    holidayText = "Следующие каникулы (Осенние) через";
                } else if (nextStart === winterBreakStart) {
                    holidayText = "Следующие каникулы (Зимние) через";
                } else if (nextStart === springBreakStart) {
                    holidayText = "Следующие каникулы (Весенние) через";
                }
            }

            if (diff <= 0) {
                holidayCountdownEl.textContent = "☀ Счастливых каникул!";
            } else {
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                holidayCountdownEl.textContent = `${holidayText} ${days} дней`;
            }

            holidayCountdownEl.style.color = isActive ? '#ff9800' : '#4fc3dc';
        }

        setInterval(updateMayCountdown, 1000);
        setInterval(updateHolidayCountdown, 60000);

        updateMayCountdown();
        updateHolidayCountdown();
    </script>

</body>

</html>